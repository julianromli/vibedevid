# Fix: Event Detail Page 404 Error

## Problem Summary
The event detail page (`/event/[slug]`) returns 404 for all events submitted to the database because it reads from mock data instead of the actual Supabase database.

## Root Cause Analysis
1. **File:** `app/event/[slug]/page.tsx` (line 14)
   - Imports `getEventBySlug` from `@/lib/events-utils` 
   - This utility only searches `mockEvents` array from `@/lib/data/mock-events`
   - Database events are never found → returns `undefined` → triggers `notFound()`

2. **Database:** Event exists and is approved
   - Slug: `vibe-coding-session-are-opencode-and-kimi-k25-worth-to-use`
   - Status: approved = true

3. **Solution:** Change import to use server action from `@/lib/actions/events` which fetches from database

## Changes Required

### 1. Update `app/event/[slug]/page.tsx`
**Current import (line 14):**
```typescript
import { formatEventDateRange, getEventBySlug, getRelatedEvents } from '@/lib/events-utils'
```

**New imports:**
```typescript
import { getEventBySlug, getEvents } from '@/lib/actions/events'
import { formatEventDateRange } from '@/lib/events-utils'
```

**Update `generateMetadata` function:**
- Change `const event = getEventBySlug(slug)` to `const { event } = await getEventBySlug(slug)`

**Update main component:**
- Change `const event = getEventBySlug(slug)` to `const { event } = await getEventBySlug(slug)`

**Update related events logic:**
- Current: `getRelatedEvents(event.category, event.id)` uses mock data
- New: Query database for related events using `getEvents()` and filter by category

### 2. Optional: Add `getRelatedEvents` to `lib/actions/events.ts`
Create a new server action to fetch related events from database:
```typescript
export async function getRelatedEvents(category: string, excludeId: string, limit: number = 3) {
  const supabase = await createClient()
  const { data, error } = await supabase
    .from('events')
    .select('*')
    .eq('category', category)
    .neq('id', excludeId)
    .eq('approved', true)
    .limit(limit)
  
  if (error) return []
  return data?.map(mapEventFromDB) || []
}
```

## Verification Steps
1. Run `bun tsc --noEmit` to ensure TypeScript compiles
2. Run `bun lint` to check for linting errors
3. Start dev server with `bun dev`
4. Navigate to: `/event/vibe-coding-session-are-opencode-and-kimi-k25-worth-to-use`
5. Verify the event page loads correctly with all event details
6. Verify related events section displays (if other events in same category)

## Files to Modify
| File | Changes |
|------|---------|
| `app/event/[slug]/page.tsx` | Update imports, make functions async, use database server actions |
| `lib/actions/events.ts` | Add `getRelatedEvents` server action (optional but recommended) |

## Risk Assessment
- **Low Risk:** The fix simply changes data source from mock to database
- **No breaking changes:** Database schema already supports all required fields
- **Backward compatible:** Existing mock data events will still work (they're also in DB)
